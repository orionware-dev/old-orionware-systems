<?xml version="1.0" encoding="UTF-8"?>
<Server port="8005" shutdown="SHUTDOWN">
    <Listener className="org.apache.catalina.startup.VersionLoggerListener" />
    <!--<Listener className="org.apache.catalina.security.SecurityListener" />-->
    <Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="on" />
    <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" />
    <Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" />
    <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" />


    <GlobalNamingResources>
        <!--Editable user database that can also be used by UserDatabaseRealm to authenticate users-->
        <Resource name="UserDatabase" auth="Container" type="org.apache.catalina.UserDatabase"
            description="User database that can be updated and saved"
            factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
            pathname="conf/tomcat-users.xml" />
    </GlobalNamingResources>


    <!--A "Service" is a collection of one or more "Connectors" that share a single "Container"-->
    <Service name="Catalina">
        <!--The connectors can use a shared executor, you can define one or more named thread pools-->
        <Executor name="tomcatThreadPool" namePrefix="catalina-exec-" maxThreads="200" minSpareThreads="25"/>
        
        
        <Connector port="8080" protocol="HTTP/1.1" executor="tomcatThreadPool" connectionUploadTimeout="300000"
            connectionTimeout="20000" maxHttpHeaderSize="500000" maxPostSize="-1"
            enableLookups="false" acceptCount="50" acceptorThreadCount="5"
            disableUploadTimeout="false" compression="on" maxConnections="10000"
            compressionMinSize="2048" noCompressionUserAgents="gozilla, traviata"
            compressableMimeType="text/html,text/xml,text/plain,image/svg+xml" />
            
        <Connector port="8443" protocol="org.apache.coyote.http11.Http11AprProtocol" maxThreads="100" scheme="https"
            secure="true" SSLEnabled="true"
            SSLVerifyClient="false" sslEnabledProtocols="TLSv1, TLSv1.1 TLSv1.2"
            enableLookups="false" acceptCount="50" acceptorThreadCount="5"
            connectionUploadTimeout="300000" disableUploadTimeout="false" compression="on" maxConnections="10000"
            compressionMinSize="2048" noCompressionUserAgents="gozilla, traviata"
            compressableMimeType="text/html,text/xml,text/plain,image/svg+xml"
            maxHttpHeaderSize="500000" maxPostSize="-1">
            
            <UpgradeProtocol className="org.apache.coyote.http2.Http2Protocol"/>
            
            <SSLHostConfig>
                <Certificate certificateKeyFile="conf/localhost-rsa-key.pem" certificateFile="conf/localhost-rsa-cert.pem"
                    certificateChainFile="conf/localhost-rsa-chain.pem" type="RSA"/>
            </SSLHostConfig>
        </Connector>


        <Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />


        <!-- You should set jvmRoute to support load-balancing via AJP ie :
        <Engine name="Catalina" defaultHost="localhost" jvmRoute="jvm1"> -->
        
        <Engine name="Catalina" defaultHost="localhost">
            <!-- <Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster"/> -->

            <!-- Use the LockOutRealm to prevent attempts to guess user passwords via a brute-force attack -->
            <Realm className="org.apache.catalina.realm.LockOutRealm">
                <Realm className="org.apache.catalina.realm.UserDatabaseRealm" resourceName="UserDatabase" />
            </Realm>

            <Host name="localhost" appBase="webapps" unpackWARs="true" autoDeploy="true">
                <!--SingleSignOn valve, share authentication between web applications-->
                <!--<Valve className="org.apache.catalina.authenticator.SingleSignOn" />-->

                <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
                    prefix="localhost_access_log" suffix=".txt" pattern="%h %l %u %t &quot;%r&quot; %s %b"/>
            </Host>
        </Engine>
    </Service>
</Server>